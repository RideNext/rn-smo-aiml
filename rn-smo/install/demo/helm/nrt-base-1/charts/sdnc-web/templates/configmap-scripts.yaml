apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "sdnc-web.fullname" . }}-scripts
  labels:
    {{- include "sdnc-web.labels" . | nindent 4 }}
data:
  dockerStats.sh: |-
    #!/bin/bash
    # Script to collect Docker stats for containers
    
    # Default to JSON output
    FORMAT="json"
    
    while getopts ":f:" opt; do
      case ${opt} in
        f )
          FORMAT=$OPTARG
          ;;
        \? )
          echo "Invalid option: $OPTARG" 1>&2
          exit 1
          ;;
        : )
          echo "Option -$OPTARG requires an argument." 1>&2
          exit 1
          ;;
      esac
    done
    
    if [ "$FORMAT" == "json" ]; then
      docker stats --no-stream --format '{"container":"{{ .Name }}","cpu":"{{ .CPUPerc }}","memory":"{{ .MemUsage }}","netio":"{{ .NetIO }}","blockio":"{{ .BlockIO }}"}' | jq -s '.'
    else
      docker stats --no-stream
    fi
